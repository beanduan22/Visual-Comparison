<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Comparison Voting</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .image-row { display: flex; justify-content: center; align-items: center; margin: 20px 0; flex-wrap: wrap; }
        .image-container { margin: 10px; text-align: center; }
        img { width: 100px; height: 100px; }
        select, input[type="number"] { width: 50px; }
        .hidden { display: none; }
        .progress-bar {
            width: 50%;
            background-color: #ddd;
            margin: 20px auto;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress { height: 100%; width: 0%; background-color: green; transition: width 0.5s; }
    </style>
    <script>
        let currentPage = 0;
        let totalPages = 20;

        function showPage(page) {
            let sections = document.querySelectorAll(".page");
            sections.forEach((section, index) => {
                section.classList.toggle("hidden", index !== page);
            });
            document.querySelector(".progress").style.width = ((page + 1) / totalPages * 100) + "%";

            document.getElementById("nextButton").classList.toggle("hidden", page === totalPages - 1);
            document.getElementById("submitButton").classList.toggle("hidden", page !== totalPages - 1);
        }

        function nextPage() {
            if (!validatePage(currentPage)) return; // Prevent skipping without valid input
            let sections = document.querySelectorAll(".page");
            if (currentPage < sections.length - 1) {
                currentPage++;
                showPage(currentPage);
            }
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                showPage(currentPage);
            }
        }

        function validatePage(page) {
            let ranks = new Set();
            let rankInputs = document.querySelectorAll(`.page:nth-child(${page + 1}) input[type='number']`);
            let scoreInputs = document.querySelectorAll(`.page:nth-child(${page + 1}) select`);

            for (let input of rankInputs) {
                let value = parseInt(input.value);
                if (!value || value < 1 || value > 7 || ranks.has(value)) {
                    alert("Each rank must be unique and between 1-7.");
                    return false;
                }
                ranks.add(value);
            }

            for (let input of scoreInputs) {
                if (!input.value) {
                    alert("Please complete all scores before proceeding.");
                    return false;
                }
            }
            return true;
        }

        window.onload = () => showPage(currentPage);
    </script>
</head>
<body>
    <h1>Visual Comparison</h1>
    <p><strong>Instructions:</strong></p>
    <p>You are to evaluate the realism of image samples generated by seven (7) different methods in comparison to the original image. Please give the rank and score for each sample.</p>
    <p><strong>Rank:</strong> Please rank the 7 samples from 1 to 7 ("1" indicates the most similar while "7" indicates the least similar to the original image). Please make sure that each sample has a unique number.</p>
    <p><strong>Score:</strong> Please rate each adversarial sampleâ€™s realism as one of the following four (4) options: 4 - Excellent, 3 - Good, 2 - Fair, 1 - Poor.</p>
    <p>The whole task may take approximately 20 minutes. Thank you very much for your participation, and we truly appreciate your time and effort on this task.</p>
    <div class="progress-bar">
        <div class="progress"></div>
    </div>

    <form method="POST">
        {% for page_num in range(10) %}
        <div class="page hidden">
            <h2>MNIST Comparison Set {{ page_num + 1 }}</h2>
            <div class="image-row">
                <div class="image-container">
                    <img src="{{ mnist_images[page_num].original }}" alt="Original Sample" style="width: 150px; height: 150px;">
                    <p>Original Sample</p>
                </div>
            </div>
            <div class="image-row">
                {% for method, adv_img in mnist_images[page_num].adversarial %}
                <div class="image-container">
                    <img src="{{ adv_img }}" alt="Adversarial Sample">
                    <p>Sample {{ loop.index }}</p>
                    <label>Rank:
                        <input type="number" name="mnist_rank_{{ adv_img }}" min="1" max="7" required>
                    </label>
                    <label>Score:
                        <select name="mnist_score_{{ adv_img }}" required>
                            <option value="" disabled selected>None</option>
                            <option value="4">4 - Excellent</option>
                            <option value="3">3 - Good</option>
                            <option value="2">2 - Fair</option>
                            <option value="1">1 - Poor</option>
                        </select>
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        {% for page_num in range(10) %}
        <div class="page hidden">
            <h2>CIFAR Comparison Set {{ page_num + 1 }}</h2>
            <div class="image-row">
                <div class="image-container">
                    <img src="{{ cifar_images[page_num].original }}" alt="Original Sample" style="width: 150px; height: 150px;">
                    <p>Original Sample</p>
                </div>
            </div>
            <div class="image-row">
                {% for method, adv_img in cifar_images[page_num].adversarial %}
                <div class="image-container">
                    <img src="{{ adv_img }}" alt="Adversarial Sample">
                    <p>Sample {{ loop.index }}</p>
                    <label>Rank:
                        <input type="number" name="cifar_rank_{{ adv_img }}" min="1" max="7" required>
                    </label>
                    <label>Score:
                        <select name="cifar_score_{{ adv_img }}" required>
                            <option value="" disabled selected>None</option>
                            <option value="4">4 - Excellent</option>
                            <option value="3">3 - Good</option>
                            <option value="2">2 - Fair</option>
                            <option value="1">1 - Poor</option>
                        </select>
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        <button type="button" onclick="previousPage()">Previous</button>
        <button type="button" onclick="nextPage()" id="nextButton">Next</button>
        <button type="submit" class="hidden" id="submitButton" onclick="showSubmitMessage()">Submit</button>
        <p id="submitMessage" class="hidden" style="color: red; font-size: 14px; margin-top: 10px;">
            Please be patient, Submit may take some time. Do not refresh the page.
        </p>

        <script>
            function showSubmitMessage() {
                document.getElementById("submitMessage").classList.remove("hidden");
            }
        </script>

    </form>
</body>
</html>
